<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <title>Weather Dashboard</title>
</head>
<body>
    <header style="background-color: #2F2F2F; height: 80px;">
        <h1 class="text-center" style="color: white;">Weather Dashboard</h1>
    </header>
    <div>
        <div class="row">
            <div id="search" class="col-3" style="background-color: #F4F4F4; ">
                <div style="margin-left: 10px;">    
                <h2>Search for a city</h2>      
                <div class="row" style="margin-left: 3px; margin-bottom: 10px;" >
                <input type="text" class="col-8" id="txtCity">
                    
                <button id="btnSearch" type="button" class="btn btn-primary col-3" onclick="getCity()">Search</button>
                </div>
                    <ul class="list-group" id="citiesList" onclick=showCityInfoFromList(event)>
                        <!-- <li class="list-group-item">Cras justo odio</li>
                        <li class="list-group-item">Dapibus ac facilisis in</li>
                        <li class="list-group-item">Morbi leo risus</li>
                        <li class="list-group-item">Porta ac consectetur ac</li>
                        <li class="list-group-item">Vestibulum at eros</li>
                        <li class="list-group-item">Vestibulum at eros</li> -->
                      </ul> <!--end of search list-->
                      </div>
            </div> <!--end of search--> 
            <div class="col-9" id="infoArea" style="background-color: white">
               <div class="row d-none" id="upperDash" style="border-bottom: 1px solid black; margin: 3px;">
                   <h3><span id="cityName"></span> - <span id="dateNow"></span>  <img id="icon"></h3>
                   <p>Temperature: <span id="temperature"></span> &#8457;</p>
                   <p>Humidity: <span id="humidity"></span> &percnt;</p>
                   <p>Wind Speed: <span id="windSpeed"></span> MPH</p>
                   <p>UV Index: <span id="UVIndex" style=" color: white;"></span></p>
               </div> <!--end of upper dashboard-->
               <div class="row d-none" style="margin: 3px;" id="lowerDash">
                   <p><strong>5 Days Forecast:</strong></p>
                   <div class="card" style="width: 12rem; margin-right: 15px; background-color:#017BFE; color: white; margin-top: 10px;">
                        <p id="dateOne"><strong></strong></p>
                        <img id="iconOne" width="50px" height="50px">
                        <p>Temp: <span id="tempOne"></span> &#8457;</p>
                        <p>Humidity: <span id="humiOne"></span> &percnt;</p>    
                    </div><!--end of card one-->
                    <div class="card" style="width: 12rem; margin-right: 15px; background-color:#017BFE; color: white; margin-top: 10px;">
                        <p id="dateTwo"><strong></strong></p>
                        <img id="iconTwo" width="50px" height="50px">
                        <p>Temp: <span id="tempTwo"></span> &#8457;</p>
                        <p>Humidity: <span id="humiTwo"></span> &percnt;</p>    
                    </div><!--end of card two-->
                    <div class="card" style="width: 12rem; margin-right: 15px; background-color:#017BFE; color: white; margin-top: 10px;">
                        <p id="dateThree"><strong></strong></p>
                        <img id="iconThree" width="50px" height="50px">
                        <p>Temp: <span id="tempThree"></span> &#8457;</p>
                        <p>Humidity: <span id="humiThree"></span> &percnt;</p>    
                    </div><!--end of card three-->
                    <div class="card" style="width: 12rem; margin-right: 15px; background-color:#017BFE; color: white; margin-top: 10px;">
                        <p id="dateFour"><strong></strong></p>
                        <img id="iconFour" width="50px" height="50px">
                        <p>Temp: <span id="tempFour"></span> &#8457;</p>
                        <p>Humidity: <span id="humiFour"></span> &percnt;</p>    
                    </div><!--end of card three-->
                    <div class="card" style="width: 12rem; margin-right: 15px; background-color:#017BFE; color: white; margin-top: 10px;">
                        <p id="dateFive"><strong></strong></p>
                        <img id="iconFive" width="50px" height="50px">
                        <p>Temp: <span id="tempFive"></span> &#8457;</p>
                        <p>Humidity: <span id="humiFive"></span> &percnt;</p>    
                    </div><!--end of card three-->
                </div> <!--end of lower dashboard-->
            </div> <!--end of info area-->
        </div> <!--end of main row-->
    </div> <!--end of container-->



  <script>

      var cities = [];



      if(localStorage.getItem("citiesList") !== null){
          cities = JSON.parse(localStorage.citiesList);
          document.querySelector('#citiesList').innerHTML = "";
          for(i=0; i<cities.length; i++)
          {
            document.querySelector('#citiesList').innerHTML += `<li class="list-group-item">${cities[i]}</li>`;
            console.log(`${cities[i]}`)
          }
      }


     async function getCity(){


        var city = document.querySelector('#txtCity').value;
        // checks if the user entered empty string
        if(city.length !== 0){
        // the following two lines to make the upper and lower dashboard visible 
        document.querySelector('#upperDash').classList.remove('d-none');
        document.querySelector('#lowerDash').classList.remove('d-none');
        
        var cityApi = await fetch( `http://api.openweathermap.org/data/2.5/weather?q=${encodeURI(city)}&appid=c18d1c67b725426cb4da6690f0f0a919`).then( r=>r.json() )
        var cityLon = cityApi.coord.lon;
        var cityLat = cityApi.coord.lat;
        getCityData(cityLon, cityLat);
        cities.push(city);
        addCity();
        }
        // console.log(city);
      }

      async function getCityData(lon, lat){
          var cityDataApi = await fetch (`https://api.openweathermap.org/data/2.5/onecall?lat=${lat}&lon=${lon}&units=imperial&appid=c18d1c67b725426cb4da6690f0f0a919`).then( r=>r.json() )
          console.log(cityDataApi)
          console.log(`Temperature = ${cityDataApi.current.temp}`)
          console.log(`Humidity = ${cityDataApi.current.humidity}`)
          console.log(`Wind speed = ${cityDataApi.current.wind_speed}`)
          console.log(`UV index = ${cityDataApi.current.uvi}`)
          console.log(`icon = ${cityDataApi.current.weather[0].icon}`)

          var temperature = cityDataApi.current.temp;
          var humadity = cityDataApi.current.humidity;
          var windSpeed = cityDataApi.current.wind_speed;
          var uvIndex = cityDataApi.current.uvi;
          var icon = cityDataApi.current.weather[0].icon;

          if(uvIndex >= 0 && uvIndex <= 2){
              document.querySelector('#UVIndex').style.backgroundColor = "green";
          }
          else if(uvIndex >= 3 && uvIndex <= 5){
              document.querySelector('#UVIndex').style.backgroundColor = "yellow";
          }
          else if(uvIndex >= 6 && uvIndex <= 7){
              document.querySelector('#UVIndex').style.backgroundColor = "orange";
          }
          else if(uvIndex >= 11 && uvIndex <= 10){
              document.querySelector('#UVIndex').style.backgroundColor = "red";
          }
          else if(uvIndex >= 11){
              document.querySelector('#UVIndex').style.backgroundColor = "purple";
          }

          var dayOneForecast = {dateOne: moment().add(1,'days').format('MMMM Do YYYY'),
                        temp: cityDataApi.daily[1].temp.day,
                        humi: cityDataApi.daily[1].humidity,
                        icon: cityDataApi.daily[1].weather[0].icon
                    }
        
            var dayTwoForecast = {dateTwo: moment().add(2,'days').format('MMMM Do YYYY'),
                        temp: cityDataApi.daily[2].temp.day,
                        humi: cityDataApi.daily[2].humidity,
                        icon: cityDataApi.daily[2].weather[0].icon
                    }
            
            var dayThreeForecast = {dateThree: moment().add(3,'days').format('MMMM Do YYYY'),
                temp: cityDataApi.daily[3].temp.day,
                humi: cityDataApi.daily[3].humidity,
                icon: cityDataApi.daily[3].weather[0].icon
            }

            var dayFourForecast = {dateFour: moment().add(4,'days').format('MMMM Do YYYY'),
                temp: cityDataApi.daily[4].temp.day,
                humi: cityDataApi.daily[4].humidity,
                icon: cityDataApi.daily[4].weather[0].icon
            }

            var dayFiveForecast = {dateFive: moment().add(5,'days').format('MMMM Do YYYY'),
                temp: cityDataApi.daily[5].temp.day,
                humi: cityDataApi.daily[5].humidity,
                icon: cityDataApi.daily[5].weather[0].icon
            }

          showMainData(temperature, humadity,windSpeed, uvIndex, icon)

          dayOne(dayOneForecast.dateOne, `http://openweathermap.org/img/wn/${dayOneForecast.icon}.png`, dayOneForecast.temp, dayOneForecast.humi)

          dayTwo(dayTwoForecast.dateTwo, `http://openweathermap.org/img/wn/${dayTwoForecast.icon}.png`, dayTwoForecast.temp, dayTwoForecast.humi)

          dayThree(dayThreeForecast.dateThree, `http://openweathermap.org/img/wn/${dayThreeForecast.icon}.png`, dayThreeForecast.temp, dayThreeForecast.humi)

          dayFour(dayFourForecast.dateFour, `http://openweathermap.org/img/wn/${dayFourForecast.icon}.png`, dayFourForecast.temp, dayFourForecast.humi)

          dayFive(dayFiveForecast.dateFive, `http://openweathermap.org/img/wn/${dayFiveForecast.icon}.png`, dayFiveForecast.temp, dayFiveForecast.humi)

        }

      function showMainData(temp, hum, wind, uv, icon){

        var userCity = document.querySelector('#txtCity').value;

        var dateNow = moment().format('MMMM Do YYYY');
        document.querySelector('#dateNow').innerHTML = dateNow;

        document.querySelector('#cityName').innerHTML = userCity;
        document.querySelector('#temperature').innerHTML = temp
        document.querySelector('#humidity').innerHTML = hum
        document.querySelector('#windSpeed').innerHTML = wind
        document.querySelector('#UVIndex').innerHTML = uv
        document.querySelector('#icon').src = `http://openweathermap.org/img/wn/${icon}.png`

      }

      function dayOne(dateDayOne, icon, temp, humi){
      document.querySelector('#dateOne').innerHTML = dateDayOne;
      document.querySelector('#iconOne').src = icon;
      document.querySelector('#tempOne').innerHTML = temp;
      document.querySelector('#humiOne').innerHTML = humi;
      }

      function dayTwo(dateDayTwo, icon, temp, humi){
      document.querySelector('#dateTwo').innerHTML = dateDayTwo;
      document.querySelector('#iconTwo').src = icon;
      document.querySelector('#tempTwo').innerHTML = temp;
      document.querySelector('#humiTwo').innerHTML = humi;
      }

      function dayThree(dateDayThree, icon, temp, humi){
      document.querySelector('#dateThree').innerHTML = dateDayThree;
      document.querySelector('#iconThree').src = icon;
      document.querySelector('#tempThree').innerHTML = temp;
      document.querySelector('#humiThree').innerHTML = humi;
      }

      function dayFour(dateDayFour, icon, temp, humi){
      document.querySelector('#dateFour').innerHTML = dateDayFour;
      document.querySelector('#iconFour').src = icon;
      document.querySelector('#tempFour').innerHTML = temp;
      document.querySelector('#humiFour').innerHTML = humi;
      }

      function dayFive(dateDayFive, icon, temp, humi){
      document.querySelector('#dateFive').innerHTML = dateDayFive;
      document.querySelector('#iconFive').src = icon;
      document.querySelector('#tempFive').innerHTML = temp;
      document.querySelector('#humiFive').innerHTML = humi;
      }

      function addCity(){
          document.querySelector('#citiesList').innerHTML = "";
          for(i=0; i<cities.length; i++)
          {
            document.querySelector('#citiesList').innerHTML += `<li class="list-group-item" onclick=showCityInfoFromList(event)>${cities[i]}</li>`;
            console.log(`${cities[i]}`)
          }
          localStorage.setItem("citiesList", JSON.stringify(cities));
          console.log("local storage is "+localStorage.citiesList)
          
      }

      // this function show information about a city from the localStored list when clicked 
      async function showCityInfoFromList(event){
        event.preventDefault();
          // the following two lines to make the upper and lower dashboard visible 
        document.querySelector('#upperDash').classList.remove('d-none');
        document.querySelector('#lowerDash').classList.remove('d-none');

        var city = event.target.innerHTML;
        document.querySelector('#txtCity').value = city
        document.querySelector('#cityName').innerHTML = city
        var cityApi = await fetch( `http://api.openweathermap.org/data/2.5/weather?q=${encodeURI(city)}&appid=c18d1c67b725426cb4da6690f0f0a919`).then( r=>r.json() )
        var cityLon = cityApi.coord.lon;
        var cityLat = cityApi.coord.lat;
        getCityData(cityLon, cityLat);
        // cities.push(city);
        // addCity();
        
        // console.log(city);
      }

  </script>
</body>
</html>